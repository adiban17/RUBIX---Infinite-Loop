<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ProctorHQ | Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="dashboard-container">
        <header>
            <div>
                <h1>ProctorHQ Monitor</h1>
                <p class="subtitle">Real-time exam surveillance system</p>
            </div>
            <div class="status-indicator">
                <div class="dot"></div>
                <span id="connection-status">Live Server</span>
            </div>
        </header>

        <div class="table-card">
            <table>
                <thead>
                    <tr>
                        <th width="20%">Student Name</th>
                        <th width="15%">Roll No</th>
                        <th width="15%">SAP ID</th>
                        <th width="15%">Start Time</th>
                        <th width="15%">End Time</th>
                        <th width="20%">Live Status</th>
                    </tr>
                </thead>
                <tbody id="student-table">
                    </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <script>
        const socket = io();
        const tableBody = document.getElementById('student-table');
        const connectionStatus = document.getElementById('connection-status');

        socket.on('connect', () => {
            connectionStatus.innerText = "System Online";
            connectionStatus.style.color = "#166534";
        });

        socket.on('update-dashboard', (students) => {
            tableBody.innerHTML = ''; 
            
            if (students.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 40px; color: #94a3b8;">Waiting for candidates to join...</td></tr>';
                return;
            }

            students.forEach(student => {
                // Determine Badge Style
                let badgeClass = "badge-normal";
                let statusText = student.riskScore || "Normal";

                if (student.riskScore && student.riskScore.includes("VIOLATION")) {
                    badgeClass = "badge-violation";
                } else if (student.riskScore === "Offline") {
                    badgeClass = "badge-neutral"; // You can add a gray style for this if you want
                    statusText = "Disconnected";
                }

                const row = `
                <tr>
                    <td style="font-weight: 500; color: #0f172a;">${student.name}</td>
                    <td style="font-family: monospace;">${student.roll}</td>
                    <td style="font-family: monospace;">${student.sap}</td>
                    <td>${student.startTime}</td>
                    <td>${student.endTime}</td>
                    <td>
                        <span class="badge ${badgeClass}">
                            ${statusText}
                        </span>
                    </td>
                </tr>`;
                
                tableBody.innerHTML += row;
            });
        });
    </script>
</body>
</html>